generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id          String      @id
  name        String
  price       Float
  category    String
  image       String
  description String
  details     Json
  rating      Float
  stock       Int
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  deletedAt   DateTime?
  items       OrderItem[]
}

model OrderCounter {
  id        Int      @id @default(1)
  lastFolio Int      @default(0)
  updatedAt DateTime @updatedAt
}

model Order {
  id           String       @id @default(cuid())
  folioNumber  Int          @unique
  folio        String       @unique
  customerName String
  status       OrderStatus  @default(PENDIENTE)
  createdAt    DateTime     @default(now())
  createdBy    String
  updatedAt    DateTime     @updatedAt
  updatedBy    String?
  deliveredAt  DateTime?
  deliveredBy  String?
  deletedAt    DateTime?
  deliveryAt   DateTime?
  audits       OrderAudit[]
  items        OrderItem[]
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  productId String
  name      String
  unitPrice Float
  qty       Int
  unit      String  @default("PZ")
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
}

model OrderAudit {
  id      String   @id @default(cuid())
  orderId String
  action  String
  byUser  String
  at      DateTime @default(now())
  note    String?
  order   Order    @relation(fields: [orderId], references: [id])

  @@index([orderId])
}

model DeliverySlot {
  id        String   @id @default(cuid())
  startAt   DateTime
  endAt     DateTime
  capacity  Int      @default(999)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([startAt])
  @@index([endAt])
  @@index([active])
}

enum OrderStatus {
  PENDIENTE
  ENTREGADO
}
