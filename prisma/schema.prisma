generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Product {
  id          String   @id
  name        String
  price       Float
  category    String
  image       String
  description String
  details     Json
  rating      Float
  stock       Int

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  items       OrderItem[]
}

model OrderCounter {
  id        Int      @id @default(1)
  lastFolio Int      @default(0)
  updatedAt DateTime @updatedAt
}

enum OrderStatus {
  PENDIENTE
  ENTREGADO
}

model DeliverySlot {
  id        String   @id @default(cuid())
  date      DateTime
  window    String
  enabled   Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders    Order[]

  @@index([date])
  @@index([enabled])
}

model Order {
  id           String      @id @default(cuid())
  folioNumber  Int         @unique
  folio        String      @unique
  customerName String
  status       OrderStatus @default(PENDIENTE)

  createdAt    DateTime    @default(now())
  createdBy    String

  updatedAt    DateTime    @updatedAt
  updatedBy    String?

  deliveredAt  DateTime?
  deliveredBy  String?

  deletedAt    DateTime?

  // âœ… horario seleccionado
  deliverySlotId String?
  deliverySlot   DeliverySlot? @relation(fields: [deliverySlotId], references: [id])

  items        OrderItem[]
  audits       OrderAudit[]

  @@index([deletedAt])
  @@index([deliverySlotId])
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  productId String
  name      String
  unitPrice Float
  qty       Int
  unit      String  @default("PZ")

  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
}

model OrderAudit {
  id      String   @id @default(cuid())
  orderId String
  action  String
  byUser  String
  at      DateTime @default(now())
  note    String?

  order   Order @relation(fields: [orderId], references: [id])

  @@index([orderId])
}
